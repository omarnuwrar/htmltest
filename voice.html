<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RINET-23FX Voice Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-dark: #3730a3;
            --primary-light: #6366f1;
            --accent-color: #10b981;
            --danger-color: #ef4444;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --card-bg: rgba(15, 23, 42, 0.6);
            --blur-effect: blur(20px);
            --glow-color: rgba(99, 102, 241, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-darker);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background Effects */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 2s ease;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: moveAndTwinkle var(--duration) infinite linear;
            opacity: 0;
        }

        .daytime {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4c669f, #3b5998, #192f6a);
            opacity: 0;
            transition: opacity 2s ease;
        }

        .cloud {
            position: absolute;
            width: var(--width);
            height: var(--height);
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            filter: blur(var(--blur));
            animation: floatCloud var(--duration) infinite linear;
            opacity: 0.6;
        }

        @keyframes moveAndTwinkle {
            0% {
                transform: translate(0, 0);
                opacity: 0;
            }
            10% { opacity: var(--opacity); }
            45% { opacity: var(--opacity); }
            50% { opacity: 0; }
            100% {
                transform: translate(var(--move-x), var(--move-y));
                opacity: 0;
            }
        }

        @keyframes floatCloud {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(calc(100vw + 100px)); }
        }

        /* Container and Layout */
        .app-container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            z-index: 1;
        }

        .brand {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .brand-name {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 2.2rem;
            background: linear-gradient(to right, var(--primary-light), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px var(--glow-color);
        }

        .tagline {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin-top: 0.5rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        /* Login Screen */
        .login-screen {
            width: 100%;
            max-width: 550px;
            padding: 2.5rem;
            background: var(--card-bg);
            backdrop-filter: var(--blur-effect);
            border-radius: 1.5rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            text-align: center;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
        }

        .welcome-img {
            width: 150px;
            height: 150px;
            margin: 0 auto 2rem;
            object-fit: cover;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .login-form {
            display: flex;
            flex-direction: column;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-field {
            width: 100%;
            padding: 1rem 1.5rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .input-field:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1rem 2rem;
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.5);
        }

        .btn-icon {
            margin-left: 0.5rem;
        }

        .feature-list {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .feature-item {
            flex: 1;
            min-width: 120px;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 1.5rem;
            color: var(--primary-light);
            margin-bottom: 0.5rem;
        }

        .feature-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* AI Interface */
        .ai-interface {
            display: none;
            width: 100%;
            max-width: 900px;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        /* AI Avatar */
        .ai-avatar-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin-bottom: 2rem;
        }

        .liquid-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.3);
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.2) 0%, rgba(15, 23, 42, 0.8) 100%);
        }

        .liquid {
            position: absolute;
            top: 0;
            left: 0;
            width: 300%;
            height: 300%;
            transform: translate(-30%, -30%);
            background: linear-gradient(45deg,
                var(--primary-light) 0%,
                #4d69fa 25%,
                #6c8aff 50%,
                #4d69fa 75%,
                var(--primary-dark) 100%);
            opacity: 0.7;
            filter: blur(10px);
            animation: liquid 8s infinite ease-in-out;
        }

        .liquid-2 {
            animation: liquid-2 12s infinite ease-in-out;
            opacity: 0.5;
            filter: blur(15px);
            transform: translate(-25%, -35%) rotate(20deg);
            background: linear-gradient(45deg,
                #4d69fa 0%,
                var(--accent-color) 50%,
                #4d69fa 100%);
        }

        .liquid-inner {
            position: absolute;
            top: 10%;
            left: 10%;
            width: 80%;
            height: 80%;
            border-radius: 50%;
            background: rgba(2, 6, 23, 0.8);
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .ai-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.4), transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 1;
        }

        .ai-glow.active {
            opacity: 1;
            animation: pulse 2s infinite ease-in-out;
        }

        .ai-icon {
            font-size: 2.5rem;
            color: var(--primary-light);
            z-index: 2;
            position: relative;
        }

        .audio-waves {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60%;
            height: 60%;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 3;
        }

        .audio-waves.active {
            opacity: 1;
        }

        .wave-bar {
            width: 4px;
            height: 30px;
            background: white;
            margin: 0 3px;
            border-radius: 5px;
            animation: waveAnimation 1s infinite ease-in-out alternate;
            animation-delay: calc(var(--i) * 0.1s);
            transform-origin: bottom;
        }

        @keyframes liquid {
            0%, 100% {
                transform: translate(-30%, -30%) rotate(0deg) scale(1);
            }
            25% {
                transform: translate(-35%, -25%) rotate(90deg) scale(1.1);
            }
            50% {
                transform: translate(-30%, -35%) rotate(180deg) scale(1);
            }
            75% {
                transform: translate(-25%, -30%) rotate(270deg) scale(1.1);
            }
        }

        @keyframes liquid-2 {
            0%, 100% {
                transform: translate(-25%, -35%) rotate(20deg) scale(1.1);
            }
            33% {
                transform: translate(-35%, -30%) rotate(110deg) scale(1);
            }
            66% {
                transform: translate(-30%, -25%) rotate(200deg) scale(1.1);
            }
        }

        /* Controls Section */
        .controls-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-bottom: 2rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 2rem;
            backdrop-filter: var(--blur-effect);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .mic-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--danger-color);
            margin-right: 0.75rem;
        }

        .mic-status.active {
            background-color: var(--accent-color);
            animation: blink 1.5s infinite;
        }

        .status-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .control-buttons {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .control-btn i {
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .control-btn.mute-btn {
            background: var(--primary-color);
        }

        .control-btn.mute-btn.active {
            background: var(--danger-color);
        }

        .control-btn.end-btn {
            background: var(--danger-color);
        }

        .control-btn.end-btn:hover {
            transform: translateY(-3px) scale(1.05);
        }

        /* Conversation Section */
        .conversation-section {
            width: 100%;
            background: var(--card-bg);
            border-radius: 1.5rem;
            backdrop-filter: var(--blur-effect);
            border: 1px solid rgba(255, 255, 255, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .conversation-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .conversation-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
        }

        .conversation-title i {
            margin-right: 0.75rem;
            color: var(--primary-light);
        }

        .conversation-actions {
            display: flex;
            gap: 0.75rem;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .conversation-content {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
            max-height: 300px;
        }

        .message {
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }

        .message:last-child {
            margin-bottom: 0;
        }

        .message-content {
            max-width: 80%;
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            font-size: 1rem;
            line-height: 1.5;
            position: relative;
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .message-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            background: var(--primary-color);
            color: white;
        }

        .ai-message .message-avatar {
            background: var(--primary-light);
        }

        .user-message {
            margin-left: auto;
        }

        .user-message .message-content {
            background: rgba(99, 102, 241, 0.15);
            border-bottom-right-radius: 4px;
            margin-left: auto;
            color: var(--text-primary);
        }

        .ai-message {
            margin-right: auto;
        }

        .ai-message .message-content {
            background: rgba(255, 255, 255, 0.05);
            border-bottom-left-radius: 4px;
            color: var(--text-primary);
        }

        .typing-indicator {
            display: inline-flex;
            align-items: center;
            margin-top: 0.5rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-secondary);
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            background: var(--accent-color);
            color: white;
            font-weight: 500;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transform: translateX(200%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 1000;
            display: flex;
            align-items: center;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--danger-color);
        }

        .notification i {
            margin-right: 0.75rem;
        }

        /* Intro Animation */
        .intro-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-darker);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .sony-intro {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .sony-logo {
            position: relative;
            width: 200px;
            height: 60px;
            overflow: visible;
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeInLogo 1s forwards 0.5s;
        }

        .logo-line {
            position: absolute;
            background: #fff;
            width: 0;
            height: 3px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: growLine 1.5s forwards 0.7s;
        }

        .rinet-text-container {
            position: relative;
            overflow: hidden;
            height: 80px;
        }

        .rinet-text {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 3.5rem;
            color: white;
            opacity: 0;
            transform: translateY(50px);
            animation: slideUp 1s forwards 1.5s;
            white-space: nowrap;
        }

        .fx-text {
            color: var(--primary-light);
            font-weight: 400;
            margin-left: 10px;
        }

        .tagline-intro {
            font-family: 'Inter', sans-serif;
            font-size: 1.2rem;
            color: var(--text-secondary);
            opacity: 0;
            margin-top: 10px;
            animation: fadeIn 1s forwards 2s;
        }

        .light-beam {
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                rgba(255, 255, 255, 0.8),
                rgba(255, 255, 255, 1),
                rgba(255, 255, 255, 0.8),
                rgba(255, 255, 255, 0.2),
                transparent);
            top: 50%;
            left: -100%;
            animation: lightSweep 1.5s forwards 2.8s;
        }

        @keyframes fadeInLogo {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes growLine {
            from { width: 0; }
            to { width: 200px; }
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        @keyframes lightSweep {
            from { left: -100%; }
            to { left: 100%; }
        }

        /* Animations */
        @keyframes waveAnimation {
            0% { transform: scaleY(0.2); }
            100% { transform: scaleY(1); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }

            .brand-name {
                font-size: 1.8rem;
            }

            .tagline {
                font-size: 1rem;
            }

            .login-screen {
                padding: 1.5rem;
            }

            .welcome-img {
                width: 120px;
                height: 120px;
            }

            .feature-list {
                flex-direction: column;
                align-items: center;
            }

            .feature-item {
                width: 100%;
                max-width: 300px;
            }

            .ai-avatar-container {
                width: 220px;
                height: 220px;
            }

            .conversation-content {
                padding: 1rem;
            }

            .control-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }

            .rinet-text {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 480px) {
            .ai-avatar-container {
                width: 180px;
                height: 180px;
            }

            .conversation-header {
                padding: 1rem;
            }

            .conversation-title {
                font-size: 1rem;
            }

            .action-btn {
                width: 32px;
                height: 32px;
            }

            .rinet-text {
                font-size: 2rem;
            }

            .tagline-intro {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Sony-Style Intro Animation -->
    <div class="intro-animation" id="introAnimation">
        <div class="sony-intro">
            <div class="sony-logo">
                <div class="logo-line"></div>
            </div>
            <div class="rinet-text-container">
                <div class="rinet-text">RINET<span class="fx-text">23FX</span></div>
            </div>
            <div class="tagline-intro">Advanced Neural Voice Intelligence</div>
            <div class="light-beam"></div>
        </div>
    </div>

    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="stars" id="starsBackground"></div>
        <div class="daytime" id="daytimeBackground"></div>
    </div>

    <div class="app-container">
        <header>
            <div class="brand">
                <h1 class="brand-name">RINET-23FX</h1>
            </div>
            <p class="tagline">Advanced Neural Voice Intelligence</p>
        </header>

        <main class="main-content">
            <!-- Login Screen -->
            <div class="login-screen" id="loginScreen">
                <img src="https://i.imgur.com/bFY3oDB.jpg" class="welcome-img" alt="AI Welcome">
                <h2 class="login-title">Begin Your AI Experience</h2>
                <form class="login-form">
                    <div class="input-group">
                        <input type="text" id="usernameInput" class="input-field" placeholder="Enter your name" required>
                    </div>
                    <button type="button" id="startBtn" class="btn btn-primary">
                        Start Experience <i class="fas fa-arrow-right btn-icon"></i>
                    </button>
                </form>

                <div class="feature-list">
                    <div class="feature-item">
                        <i class="fas fa-brain feature-icon"></i>
                        <p class="feature-text">Advanced AI</p>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-comments feature-icon"></i>
                        <p class="feature-text">Natural Dialogue</p>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-film feature-icon"></i>
                        <p class="feature-text">Movie Knowledge</p>
                    </div>
                </div>
            </div>

            <!-- AI Interface -->
            <div class="ai-interface" id="aiInterface">
                <div class="ai-avatar-container">
                    <div class="liquid-container">
                        <div class="liquid"></div>
                        <div class="liquid liquid-2"></div>
                        <div class="liquid-inner">
                            <div class="ai-glow" id="aiGlow"></div>
                            <i class="fas fa-microchip ai-icon"></i>
                            <div class="audio-waves" id="audioWaves">
                                <div class="wave-bar" style="--i: 1"></div>
                                <div class="wave-bar" style="--i: 2"></div>
                                <div class="wave-bar" style="--i: 3"></div>
                                <div class="wave-bar" style="--i: 4"></div>
                                <div class="wave-bar" style="--i: 5"></div>
                                <div class="wave-bar" style="--i: 6"></div>
                                <div class="wave-bar" style="--i: 7"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="controls-section">
                    <div class="status-indicator">
                        <div class="mic-status" id="micStatus"></div>
                        <span class="status-text" id="statusText">Ready to begin</span>
                    </div>

                    <div class="control-buttons">
                        <div class="control-btn mute-btn" id="muteBtn" title="Mute/Unmute">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <div class="control-btn" id="themeBtn" title="Switch Theme">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div class="control-btn end-btn" id="endBtn" title="End Session">
                            <i class="fas fa-phone-slash"></i>
                        </div>
                    </div>
                </div>

                <div class="conversation-section">
                    <div class="conversation-header">
                        <div class="conversation-title">
                            <i class="fas fa-comments"></i> Conversation
                        </div>
                        <div class="conversation-actions">
                            <button class="action-btn" id="clearBtn" title="Clear">
                                <i class="fas fa-broom"></i>
                            </button>
                            <button class="action-btn" id="saveBtn" title="Save">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                    </div>
                    <div class="conversation-content" id="conversationContent">
                        <!-- Messages will appear here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <span id="notificationText">Notification message</span>
    </div>

    <script>
        // DOM Elements
        const introAnimation = document.getElementById('introAnimation');
        const starsBackground = document.getElementById('starsBackground');
        const daytimeBackground = document.getElementById('daytimeBackground');
        const loginScreen = document.getElementById('loginScreen');
        const aiInterface = document.getElementById('aiInterface');
        const usernameInput = document.getElementById('usernameInput');
        const startBtn = document.getElementById('startBtn');
        const muteBtn = document.getElementById('muteBtn');
        const endBtn = document.getElementById('endBtn');
        const themeBtn = document.getElementById('themeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const saveBtn = document.getElementById('saveBtn');
        const conversationContent = document.getElementById('conversationContent');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        const statusText = document.getElementById('statusText');
        const micStatus = document.getElementById('micStatus');
        const aiGlow = document.getElementById('aiGlow');
        const audioWaves = document.getElementById('audioWaves');

        // Global Variables
        let username = '';
        let audioContext;
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let isMuted = false;
        let currentAudio = null;
        let silenceTimeout = null;
        let silenceDetectionInterval = null;
        let audioAnalyser = null;
        let audioDataArray = null;
        let isNightTheme = true;
        let sessionActive = false;

        // Initialization Functions
        function initializeApp() {
            // Play intro animation
            setTimeout(() => {
                introAnimation.style.opacity = '0';
                setTimeout(() => {
                    introAnimation.style.display = 'none';
                }, 500);
            }, 4500);

            // Create background elements
            createStars();
            createClouds();

            // Initialize event listeners
            initEventListeners();
        }

        function createStars() {
            const starCount = 200;
            starsBackground.innerHTML = '';

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');

                // Random position
                const x = Math.random() * 100;
                const y = Math.random() * 100;

                // Random size
                const size = Math.random() * 2 + 1;

                // Random movement distance
                const moveX = (Math.random() - 0.5) * 20;
                const moveY = (Math.random() - 0.5) * 20;

                // Random opacity and duration
                const opacity = Math.random() * 0.8 + 0.2;
                const duration = Math.random() * 8 + 12;

                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.setProperty('--opacity', opacity);
                star.style.setProperty('--duration', `${duration}s`);
                star.style.setProperty('--move-x', `${moveX}px`);
                star.style.setProperty('--move-y', `${moveY}px`);

                starsBackground.appendChild(star);
            }
        }

        function createClouds() {
            const cloudCount = 10;
            daytimeBackground.innerHTML = '';

            for (let i = 0; i < cloudCount; i++) {
                const cloud = document.createElement('div');
                cloud.classList.add('cloud');

                // Random size
                const width = Math.random() * 200 + 100;
                const height = width * 0.6;

                // Random position
                const y = Math.random() * 70 + 5;

                // Random duration and blur
                const duration = Math.random() * 60 + 60;
                const blur = Math.random() * 10 + 10;

                cloud.style.setProperty('--width', `${width}px`);
                cloud.style.setProperty('--height', `${height}px`);
                cloud.style.top = `${y}%`;
                cloud.style.setProperty('--blur', `${blur}px`);
                cloud.style.setProperty('--duration', `${duration}s`);
                cloud.style.animationDelay = `-${Math.random() * 60}s`;

                daytimeBackground.appendChild(cloud);
            }
        }

        function initEventListeners() {
            startBtn.addEventListener('click', handleStart);
            endBtn.addEventListener('click', endSession);
            muteBtn.addEventListener('click', toggleMute);
            themeBtn.addEventListener('click', toggleTheme);
            clearBtn.addEventListener('click', clearConversation);
            saveBtn.addEventListener('click', saveConversation);

            // Adding keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Space to toggle mute
                if (e.code === 'Space' && aiInterface.style.display === 'flex') {
                    e.preventDefault();
                    toggleMute();
                }
                // Escape to end call
                if (e.code === 'Escape' && aiInterface.style.display === 'flex') {
                    endSession();
                }
            });
        }

        // Core Functionality
        function handleStart() {
            username = usernameInput.value.trim();
            if (!username) {
                showNotification('Please enter your name', true);
                usernameInput.focus();
                return;
            }

            // Request microphone access
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    setupAudioProcessing(stream);
                    startSession();
                })
                .catch(error => {
                    console.error('Error accessing microphone:', error);
                    showNotification('Microphone access denied. Please enable it in your browser settings.', true);
                });
        }

        function startSession() {
            // Mark session as active
            sessionActive = true;

            // Switch UI
            loginScreen.style.display = 'none';
            aiInterface.style.display = 'flex';

            // Make initial API call to start session
            fetch('https://corvo-ai-back-end.hf.space/api/start-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && sessionActive) {
                    // Add initial AI message
                    addMessage('RINET-23FX', data.ai_response, 'ai');

                    // Play the AI response
                    playAudioFromBase64(data.audio);
                } else if (!sessionActive) {
                    console.log("Session ended, ignoring response");
                } else {
                    showNotification(data.error || 'Failed to start session', true);
                }
            })
            .catch(error => {
                console.error('Error starting session:', error);
                if (sessionActive) {
                    showNotification('Failed to connect to server. Please try again.', true);
                }
            });
        }

        function setupAudioProcessing(stream) {
            // Set up audio context for processing
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const source = audioContext.createMediaStreamSource(stream);
            audioAnalyser = audioContext.createAnalyser();
            audioAnalyser.fftSize = 256;
            source.connect(audioAnalyser);

            audioDataArray = new Uint8Array(audioAnalyser.frequencyBinCount);

            // Set up media recorder
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = event => {
                if (event.data.size > 0) {
                    audioChunks.push(event.data);
                }
            };

            mediaRecorder.onstop = () => {
                if (!sessionActive) return;

                const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
                sendAudioToServer(audioBlob);
                audioChunks = [];
            };
        }

        function startListening() {
            if (!sessionActive || isMuted) return;

            isRecording = true;
            audioChunks = [];
            statusText.textContent = 'Listening...';
            micStatus.classList.add('active');
            aiGlow.classList.add('active');

            // Start recording
            if (mediaRecorder && mediaRecorder.state !== 'recording') {
                mediaRecorder.start();
            }

            // Set up silence detection
            silenceDetectionInterval = setInterval(detectSilence, 100);
        }

        function stopListening() {
            if (!isRecording) return;

            isRecording = false;
            statusText.textContent = 'Processing...';
            micStatus.classList.remove('active');
            aiGlow.classList.remove('active');

            // Clear silence detection
            clearInterval(silenceDetectionInterval);
            clearTimeout(silenceTimeout);

            // Stop recording
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }
        }

        function detectSilence() {
            if (!sessionActive) {
                clearInterval(silenceDetectionInterval);
                return;
            }

            audioAnalyser.getByteFrequencyData(audioDataArray);

            // Calculate average volume
            let sum = 0;
            for (let i = 0; i < audioDataArray.length; i++) {
                sum += audioDataArray[i];
            }
            const average = sum / audioDataArray.length;

            // If sound is detected, reset the silence timeout
            if (average > 10) {
                clearTimeout(silenceTimeout);
                silenceTimeout = setTimeout(stopListening, 1800); // Stop after 1.8 seconds of silence
            } else if (!silenceTimeout) {
                silenceTimeout = setTimeout(stopListening, 1800);
            }
        }

        function sendAudioToServer(audioBlob) {
            if (!sessionActive) return;

            const formData = new FormData();
            formData.append('audio', audioBlob);

            fetch('https://corvo-ai-back-end.hf.space/api/send-audio', {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (!sessionActive) {
                    console.log("Session ended, ignoring response");
                    return;
                }

                if (data.success) {
                    // Add user message
                    addMessage(username, data.transcription, 'user');

                    // Add AI response
                    addMessage('RINET-23FX', data.ai_response, 'ai');

                    // Play the AI response
                    playAudioFromBase64(data.audio);
                } else {
                    showNotification(data.error || 'Failed to process audio', true);
                    startListening(); // Resume listening
                }
            })
            .catch(error => {
                console.error('Error sending audio:', error);
                if (sessionActive) {
                    showNotification('Failed to reach server. Please check your connection.', true);
                    startListening(); // Resume listening
                }
            });
        }

        function playAudioFromBase64(base64Audio) {
            if (!sessionActive) return;

            if (!base64Audio) {
                console.error('No audio data received');
                startListening();
                return;
            }

            // Stop current audio if playing
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            // Show audio waves and update status
            audioWaves.classList.add('active');
            statusText.textContent = 'RINET is speaking...';
            aiGlow.classList.add('active');

            // Convert base64 to blob
            const byteCharacters = atob(base64Audio);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const audioBlob = new Blob([byteArray], { type: 'audio/mp3' });

            // Create audio element
            const audio = new Audio(URL.createObjectURL(audioBlob));
            currentAudio = audio;

            // Listen for audio end
            audio.onended = () => {
                if (sessionActive) {
                    audioWaves.classList.remove('active');
                    aiGlow.classList.remove('active');
                    startListening();
                }
            };

            // Play audio
            audio.play().catch(err => {
                console.error('Error playing audio:', err);
                if (sessionActive) {
                    audioWaves.classList.remove('active');
                    aiGlow.classList.remove('active');
                    startListening();
                }
            });

            // Listen for user interruption
            document.addEventListener('click', interruptSpeaking, { once: true });
        }

        function interruptSpeaking() {
            if (currentAudio && !isRecording && sessionActive) {
                // Stop the AI from speaking
                currentAudio.pause();
                currentAudio = null;
                audioWaves.classList.remove('active');
                aiGlow.classList.remove('active');

                // Notify the server about the interruption
                fetch('https://corvo-ai-back-end.hf.space/api/interrupt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({}),
                })
                .then(() => {
                    if (sessionActive) startListening();
                })
                .catch(error => {
                    console.error('Error interrupting:', error);
                    if (sessionActive) startListening();
                });
            }
        }

        function addMessage(sender, content, type) {
            const messageEl = document.createElement('div');
            messageEl.classList.add('message', `${type}-message`);

            const headerEl = document.createElement('div');
            headerEl.classList.add('message-header');

            const avatarEl = document.createElement('div');
            avatarEl.classList.add('message-avatar');
            avatarEl.textContent = sender.charAt(0).toUpperCase();

            const senderNameEl = document.createElement('span');
            senderNameEl.textContent = sender;

            headerEl.appendChild(avatarEl);
            headerEl.appendChild(senderNameEl);

            const contentEl = document.createElement('div');
            contentEl.classList.add('message-content');
            contentEl.textContent = content;

            messageEl.appendChild(headerEl);
            messageEl.appendChild(contentEl);

            conversationContent.appendChild(messageEl);
            conversationContent.scrollTop = conversationContent.scrollHeight;

            // Trigger entry animation
            setTimeout(() => {
                messageEl.style.opacity = '1';
                messageEl.style.transform = 'translateY(0)';
            }, 10);
        }

        function toggleMute() {
            if (!sessionActive) return;

            isMuted = !isMuted;

            if (isMuted) {
                muteBtn.classList.add('active');
                muteBtn.querySelector('i').className = 'fas fa-microphone-slash';

                if (isRecording) {
                    stopListening();
                }

                statusText.textContent = 'Microphone muted';
                micStatus.classList.remove('active');
                showNotification('Microphone muted');
            } else {
                muteBtn.classList.remove('active');
                muteBtn.querySelector('i').className = 'fas fa-microphone';

                if (!currentAudio || currentAudio.paused) {
                    startListening();
                }

                showNotification('Microphone active');
            }
        }

        function toggleTheme() {
            isNightTheme = !isNightTheme;

            if (isNightTheme) {
                starsBackground.style.opacity = '1';
                daytimeBackground.style.opacity = '0';
                themeBtn.querySelector('i').className = 'fas fa-moon';
                document.body.style.backgroundColor = 'var(--bg-darker)';
            } else {
                starsBackground.style.opacity = '0';
                daytimeBackground.style.opacity = '1';
                themeBtn.querySelector('i').className = 'fas fa-sun';
                document.body.style.backgroundColor = '#192f6a';
            }
        }

        function clearConversation() {
            conversationContent.innerHTML = '';
            showNotification('Conversation cleared');
        }

        function saveConversation() {
            const messages = conversationContent.querySelectorAll('.message');
            let conversationText = '';

            messages.forEach(msg => {
                const sender = msg.querySelector('.message-header').textContent;
                const content = msg.querySelector('.message-content').textContent;
                conversationText += `${sender}: ${content}\n\n`;
            });

            // Create blob and download
            const blob = new Blob([conversationText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `RINET_Conversation_${new Date().toISOString().slice(0, 10)}.txt`;
            a.click();

            showNotification('Conversation saved');
        }

        function endSession() {
            // Mark session as inactive first to prevent further processing
            sessionActive = false;

            // Stop recording if active
            if (isRecording && mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                isRecording = false;
            }

            // Stop current audio if playing
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                audioWaves.classList.remove('active');
                aiGlow.classList.remove('active');
            }

            // Clear intervals and timeouts
            clearInterval(silenceDetectionInterval);
            clearTimeout(silenceTimeout);

            // End the session with the server
            fetch('https://corvo-ai-back-end.hf.space/api/end-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({}),
            })
            .then(() => {
                // Switch back to login view
                aiInterface.style.display = 'none';
                loginScreen.style.display = 'block';

                // Reset UI
                conversationContent.innerHTML = '';
                statusText.textContent = 'Ready to begin';
                micStatus.classList.remove('active');

                // Reset variables
                username = '';
                usernameInput.value = '';
                isMuted = false;
                muteBtn.classList.remove('active');
                muteBtn.querySelector('i').className = 'fas fa-microphone';

                showNotification('Session ended');
            })
            .catch(error => {
                console.error('Error ending session:', error);
                showNotification('Failed to properly end session', true);

                // Still reset UI even if server request fails
                aiInterface.style.display = 'none';
                loginScreen.style.display = 'block';
                conversationContent.innerHTML = '';
                username = '';
                usernameInput.value = '';
            });
        }

        function showNotification(message, isError = false) {
            notificationText.textContent = message;
            notification.className = 'notification';

            if (isError) {
                notification.classList.add('error');
                notification.querySelector('i').className = 'fas fa-exclamation-circle';
            } else {
                notification.querySelector('i').className = 'fas fa-check-circle';
            }

            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
